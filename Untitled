---
title: "test"
author: "Naomi Buell and Richie Rivera"
format: html
editor: visual
---

## Intro

```{r}
#| label: load packages

library(tidyverse)
library(janitor) 
library(httr) 
library(jsonlite) 
library(skimr)
```

Load [PLACES: Census Tract Data (GIS Friendly Format), 2024 release data](https://data.cdc.gov/500-Cities-Places/PLACES-Census-Tract-Data-GIS-Friendly-Format-2024-/yjkw-uj5s/about_data) for New York state by census tract

```{r}
#| load: CDC places API

# API endpoint from link above
base_url <- "https://data.cdc.gov/resource/yjkw-uj5s.json"

# Define the query parameters
query_params <- list(
    "$where" = "statedesc='New York'",
    "$select" = "stateabbr, statedesc, countyname, countyfips, tractfips, totalpopulation, totalpop18plus, geolocation, isolation_crudeprev, isolation_crude95ci", # Not sure why isolation variables are not getting pulled in
    "$limit" = 100000
)

# Make a GET request to the API endpoint with query parameters
response <- GET(base_url, query = query_params)

# Check if the request was successful
if (status_code(response) == 200) {
  # Parse the JSON response
  data <- fromJSON(content(response, "text"))
  
} else {
  cat("Failed to retrieve data. HTTP Status code:", status_code(response), "\n")
}
```

Browse the data.

```{r}
#| label: data exploration

clean_data  <- data |> clean_names()

clean_data |> skim()
clean_data <- clean_data |>    
  select(stateabbr, statedesc, countyname, countyfips, tractfips, totalpopulation, totalpop18plus, geolocation, isolation_crudeprev, isolation_crude95ci)

```